---
title: "nginx部署实践"
date: 2019-07-04 17:54:46
tags:
- nginx
---

### 1. 配置文件在哪

安装好nginx我们首先要知道配置文件在哪里?


![1](nginx部署实践/1.png)



说明nginx的主配置文件都在 `/etc/nginx/nginx.conf`里. 打开文件我们还可以看到

```ngnix
include /etc/nginx/conf.d/*.conf;
include /etc/nginx/sites-enabled/*;
```



需要添加新配置选项的地方位于 sites-enabled 文件夹。如果你打开这个文件夹，你会发现一个名为 default 的文档，打开后你就会找到nginx的配置选项, 当你安装好nginx默认看到的首页就是在这里配置的.



在该目录下还有一个 sites-available 的文件夹, 这个文件夹一般在你需要建立和管理多个站点的时候非常有用，可以帮助你更好的组织不同的项目。你需要在这里添加你的nginx配置文案并将他们链接至 sites-enabled 目录下。



只有在 sites-enabled 目录下的配置文件才能够真正被用户访问。但是你同样可以将文件放在 sites-available 目录下用来存档或者生成链接。

<!-- more -->



### 2. 重启nginx

```bash
sudo nginx -s reload
```



reload，重新加载的意思，reload会重新加载配置文件，nginx服务不会中断，而且reload时会测试conf语法等，如果出错会rollback用上一次正确配置文件保持正常运行。

restart，重启，会重启nginx服务。这个重启会造成服务一瞬间的中断，当然如果配置文件出错会导致服务启动失败，那就是更长时间的服务中断了。



### 3. 域名概念

##### 3.1 二级域名

二级域名是指顶级域名之下的域名, 见下面的例子:

- .com 顶级域名
  - liuvv.com 一级域名(你花钱申请的)
    - www.liuvv.com 二级域名
    - blog.liuvv.com 二级域名
    - 依次类推...

有几点需要注意下:

1. www.liuvv.com是属于二级域名,不过一般我们把这个域名配置指向一级域名访问.
2. www.liuvv.com/news这种形式一般称之为网站的子页面子目录等,并不是二级域名.
3. 另外类似.com.cn, .net.cn, .org.cn这种称之为二级域.

##### 3.2 域名泛解析

我们的目的是实现访问二级域名后转发请求.首先要实现的是二级域名的配置,一般使用Nginx泛解析来处理. 泛解析即利用通配符*来做次级域名以实现所有的次级域名均指向同一IP地址。

泛解析的用途有:

1. 可以让域名支持无限的子域名(这也是泛域名解析最大的用途)。

2. 防止用户错误输入导致的网站不能访问的问题。

3. 可以让直接输入网址登陆网站的用户输入简洁的网址即可访问网站。





### 4. 域名配置



##### 4.1 配置泛解析

去域名提供商那里先配置一个泛解析地址,记录类型为A.域名指向一个IPv4地址.主机记录设置为*.记录值填写服务器公网Ip地址.

配置好后稍微等待一下,然后访问这个域名.可以随意输入任何二级域名,访问到的都应该是顶级域名的内容.我这里访问结果总是Nginx的默认页面.

![1](nginx部署实践/2.png)







### 参考资料

+ [Nginx 泛解析配置请求映射到多端口实现二级域名访问](https://www.cnblogs.com/summit7ca/p/6974215.html)